{% block js_files %}
    <script src="js/leaderboardFilters.js"></script>
{% endblock %}

<div class="mb-2 leaderboard-header-container">
    <div id="leaderboard-description-text">
        <!-- Dynamic text will be inserted here -->
    </div>
    <div class="filter-controls-group border-top pt-2">
        <div style="position: relative; display: inline-flex;">
            <button id="compare-btn" class="button button-primary button-icon" type="button" title="Compare selected results" style="display: none;">
                <i class="fa-solid fa-chart-column"></i>
                <span>Compare results</span>
            </button>
            <span class="new-badge new-badge-button">New!</span>
        </div>
        <div class="filter-title">Filters:</div>
        <div class="filter-buttons">
            <!-- Main Filters Dropdown -->
            <div class="multiselect-container" id="main-filters">
                <button class="btn btn-sm btn-outline-secondary filter-toggle multiselect-toggle" type="button" title="Filter by system properties">
                    <span class="multiselect-summary">Open Scaffold</span>
                    <span class="multiselect-icon">▼</span>
                </button>
                <form class="multiselect-form">
                    <div class="multiselect-dropdown">
                        <div class="multiselect-options">
                            <!-- Filter options will be dynamically populated here -->
                        </div>
                    </div>
                </form>
            </div>

            <!-- Tags Dropdown -->
            <div class="multiselect-container" id="tag-filters">
                <button class="btn btn-sm btn-outline-secondary filter-toggle multiselect-toggle" type="button" title="Filter by tags">
                    <span class="multiselect-summary">All Tags</span>
                    <span class="multiselect-icon">▼</span>
                </button>
                <form class="multiselect-form">
                    <div class="multiselect-dropdown">
                        <div class="multiselect-options" id="tag-options-container">
                            <!-- Tag options will be dynamically populated here -->
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Container for dynamically loaded table content -->
<div id="leaderboard-container">
    <!-- Initial table will be loaded here -->
</div>

<script type="application/json" id="leaderboard-data">
    {{ leaderboards | tojson }}
</script>

<script type="application/json" id="leaderboard-tags-data">
    {{ leaderboard_tags | tojson }}
</script>

<!-- Chart.js and analysis for comparison -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="js/charts/barChart.js"></script>
<script src="js/charts/scatterChart.js"></script>
<script src="js/charts/cumulativeCostChart.js"></script>
<script src="js/charts/groupedBarChart.js"></script>
<script src="js/charts/resolvedVsLimitChart.js"></script>
<script src="js/charts/resolvedVsAvgCostChart.js"></script>
<script src="js/charts/resolvedInstancesMatrix.js"></script>
<script src="js/analysis.js"></script>

<!-- Compare Results Modal -->
<div id="compare-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-dialog modal-dialog-large" role="dialog" aria-modal="true" aria-labelledby="compare-modal-title">
        <div class="modal-header">
            <h3 id="compare-modal-title" class="m-0">Compare results</h3>
            <button class="modal-close" aria-label="Close" data-close="true"><i class="fa fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
                <select id="compare-chart-type" class="form-control form-select" style="flex: 1 1 200px;">
                    <option value="bar" selected>Resolved (bar chart)</option>
                    <option value="grouped-bar">Resolved by repository</option>
                    <option value="resolved-instances-matrix">Resolved instances matrix</option>
                    <option value="scatter">Resolved vs cost (scatter plot)</option>
                    <option value="resolved-vs-avg-cost">Resolved vs average cost</option>
                    <option value="resolved-vs-cost-limit">Resolved vs cost limit</option>
                    <option value="resolved-vs-step-limit">Resolved vs step limit</option>
                    <option value="cumulative-cost">Cumulative cost distribution</option>
                    <option value="cumulative-cost-resolved">Cumulative cost distribution (resolved only)</option>
                    <option value="cumulative-steps">Cumulative step distribution</option>
                    <option value="cumulative-steps-resolved">Cumulative step distribution (resolved only)</option>
                </select>
                <button id="chart-theme-toggle" class="btn btn-sm btn-outline-secondary" type="button" title="Switch theme">
                    <i class="fa fa-sun"></i>&nbsp;Light
                </button>
                <button id="quickselect-btn" class="btn btn-sm btn-outline-secondary" type="button" title="Quick select models">
                    <i class="fa fa-check-square"></i>&nbsp;Selection
                </button>
                <button id="download-json-btn" class="btn btn-sm btn-outline-secondary" type="button" title="Download data as JSON">
                    <i class="fa fa-download"></i>&nbsp;JSON
                </button>
                <button id="download-png-btn" class="btn btn-sm btn-outline-secondary" type="button" title="Download chart as PNG">
                    <i class="fa fa-download"></i>&nbsp;PNG
                </button>
            </div>
            <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
                <select id="matrix-chunk-selector" class="form-control form-select" style="flex: 1 1 200px; display: none;">
                    <option value="0">Instances 1-100</option>
                    <option value="100">Instances 101-200</option>
                    <option value="200">Instances 201-300</option>
                    <option value="300">Instances 301-400</option>
                    <option value="400">Instances 401-500</option>
                </select>
            </div>
            <div class="mt-2 chart-container">
                <canvas id="compare-chart"></canvas>
                <div id="compare-empty" class="text-muted mt-2">Select models via the checkboxes, then click <em>Compare results</em>.</div>
            </div>
        </div>
    </div>
    
    
</div>

<!-- No Selection Modal -->
<div id="no-selection-modal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="true"></div>
    <div class="modal-dialog modal-dialog-small" role="dialog" aria-modal="true" aria-labelledby="no-selection-modal-title">
        <div class="modal-header">
            <h3 id="no-selection-modal-title" class="m-0">No models selected</h3>
            <button class="modal-close" aria-label="Close" data-close="true"><i class="fa fa-times"></i></button>
        </div>
        <div class="modal-body">
            <p class="mb-3">Select at least one model using the checkboxes in the first columns, or click one of the following buttons for a pre-defined selection.</p>
            <p class="mb-2 fw-medium">Quick select:</p>
            <div class="d-flex gap-2 flex-wrap">
                <button id="select-top-10" class="button button-primary" type="button">Select top 10</button>
                <button id="select-top-20" class="button button-secondary" type="button">Select top 20</button>
                <button id="select-all" class="button button-secondary" type="button">Select all</button>
                <button id="select-all-ow" class="button button-secondary" type="button">Select all (open weights)</button>
            </div>
        </div>
    </div>
</div>

<div class="leaderboard-notes">
    <p>
        SWE-bench <b>Bash Only</b> uses the SWE-bench Verified dataset with the <a href="https://github.com/SWE-agent/mini-swe-agent">mini-SWE-agent</a> environment for all models [<a href="bash-only.html">Post</a>].<br>
        SWE-bench <b>Lite</b> is a subset curated for less costly evaluation [<a href="lite.html">Post</a>].<br>
        SWE-bench <b>Verified</b> is a human-filtered subset [<a href="https://openai.com/index/introducing-swe-bench-verified/">Post</a>].<br>
        SWE-bench <b>Multimodal</b> features issues with visual elements [<a href="multimodal.html">Post</a>].<br>
    </p>
    <p>Each entry reports the <b>% Resolved</b> metric, the percentage of instances solved (out of 2294 Full, 500 Verified & Bash Only, 300 Lite, 517 Multimodal).</p>
</div>